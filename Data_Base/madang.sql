--DROP USER c##madang CASCADE;
--CREATE USER c##madang IDENTIFIED BY madang DEFAULT TABLESPACE users TEMPORARY TABLESPACE temp PROFILE DEFAULT;
--GRANT CONNECT, RESOURCE TO c##madang;
--GRANT CREATE VIEW, CREATE SYNONYM TO c##madang;
--GRANT UNLIMITED TABLESPACE TO c##madang;
--ALTER USER c##madang ACCOUNT UNLOCK;


-- table 생성
conn c##madang/madang;
CREATE TABLE CUSTOMER(
cno NUMBER(5) NOT NULL,
name VARCHAR(20),
password VARCHAR(15),
email VARCHAR2(30),
CONSTRAINT customer_pk PRIMARY KEY (cno),
CONSTRAINT customer_uq UNIQUE (email),
CONSTRAINT CHK_cno CHECK (cno>=0)
);

CREATE TABLE EBOOK(
isbn NUMBER(5) NOT NULL,
title VARCHAR2(50),
publisher VARCHAR2(50),
year DATE,
cno NUMBER(5),
extTimes NUMBER(1) CHECK (extTimes>=0 AND extTimes<=2),
dateRented DATE,
dateDue DATE,
CONSTRAINT ebook_pk PRIMARY KEY (isbn),
CONSTRAINT ebook_fk FOREIGN KEY (cno) REFERENCES CUSTOMER(cno)
);

CREATE TABLE RESERVATION(
isbn NUMBER(5) NOT NULL,
cno NUMBER(5) NOT NULL,
reservationTime DATE,
CONSTRAINT reservation_fk1 FOREIGN KEY (isbn) REFERENCES EBOOK(isbn),
CONSTRAINT reservation_fk2 FOREIGN KEY (cno) REFERENCES CUSTOMER(cno)
);

CREATE TABLE PREVIOUS_RENTAL(
isbn NUMBER(5) NOT NULL,
dateRented DATE NOT NULL,
dateReturned DATE NOT NULL,
cno NUMBER(5) NOT NULL,
CONSTRAINT previousRental_pk PRIMARY KEY (isbn, dateRented),
CONSTRAINT previousRental_fk1 FOREIGN KEY (isbn) REFERENCES EBOOK(isbn),
CONSTRAINT previousRental_fk2 FOREIGN KEY (cno) REFERENCES CUSTOMER(cno)
);

CREATE TABLE AUTHORS(
isbn NUMBER(5) NOT NULL,
author VARCHAR(50) NOT NULL,
CONSTRAINT authors_pk PRIMARY KEY (author),
CONSTRAINT authors_fk FOREIGN KEY (isbn) REFERENCES EBOOK(isbn)
);

DESCRIBE customer;
DESCRIBE ebook;
DESCRIBE reservation;
DESCRIBE previous_rental;
DESCRIBE authors;

CREATE VIEW ReservationInfo
AS
SELECT ebook.isbn as "예약 도서 ISBN", ebook.title "예약 도서 제목", customer.cno "예약 고객 CNO", 
        customer.name "예약 고객 이름", NVL(customer.email,0) "예약 고객 이름", reservation.reservationtime "예약시간"
FROM customer, reservation, ebook
WHERE reservation.isbn = ebook.isbn AND reservation.cno = customer.cno
ORDER BY reservation.reservationTime DESC;

select ReservationInfo, text
from user_views;

-- data 삽입
-- 2021년 3월 15일 기준
INSERT INTO CUSTOMER VALUES (30430, '손흥민', 'zxcviopu', 'torto@naver.com');
INSERT INTO CUSTOMER VALUES (30431, '황의조', 'wertm/,', 'asdio@daum.net');
INSERT INTO CUSTOMER VALUES (30432, '황희찬', 'oi;rujg', NULL);
INSERT INTO CUSTOMER VALUES (30433, '이강인', 'ilkh;oh', NULL);
INSERT INTO CUSTOMER VALUES (30434, '박주호', '.jknuujh', 'nbbfr@gmail.com');
INSERT INTO CUSTOMER VALUES (30435, '김민재', 'puiyhjk', NULL);
INSERT INTO CUSTOMER VALUES (30436, '조현우', '023654', NULL);
INSERT INTO CUSTOMER VALUES (30437, '김영권', 'uyity', NULL);
INSERT INTO CUSTOMER VALUES (30438, '정우영', '00vbn0', 'hgdg@daum.net');
INSERT INTO CUSTOMER VALUES (30439, '김승규', '0qweds', NULL);
INSERT INTO CUSTOMER VALUES (30440, '이승우', '0ewqrwdf', 'fghb@gmail.com');
INSERT INTO CUSTOMER VALUES (30441, '나상호', '0zcvbzb', NULL);
INSERT INTO CUSTOMER VALUES (30442, '이용', ';klhj;hkj', 'sdfg@naver.com');
INSERT INTO CUSTOMER VALUES (30443, '김진현', 'asdfasreqw', NULL);

INSERT INTO EBOOK VALUES (15600, '뉴욕주민의 진짜 미국식 주식투자', '비즈니스북스', '2013-05-12', 30435,'1', '2021-02-25', '2021-03-17');
INSERT INTO EBOOK VALUES (15601, '처음 읽는 술의 세계사', '탐나는책', '2011-12-17', NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15602, 'IT 개발자의 거의 모든 것', '미래의창','2012-06-05',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15603, '친절한 서양 미술사', '문예춘추사','2006-11-24', 30440,'1', '2021-03-08', '2021-03-29');
INSERT INTO EBOOK VALUES (15604, '레서판다도 스케일링을 한다', '제이앤제이','2016-11-04',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15605, '이윤기의 그리스 로마 신화', '웅진지식하우스','2004-12-16',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15606, '팀 켈러의 인생 베이직 세트', '두란노','2016-04-11',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15607, '지적 대화를 위한 30분', '웅진지식하우스','2015-06-14',30430,'0', '2021-03-10', '2021-03-21');
INSERT INTO EBOOK VALUES (15608, '펭귄 레드에디션', '펭귄클레식코리아','2018-09-17',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15609, '조제와 호랑이와 물고기들', '작가정신','2010-02-23',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15610, '초격차: 리더의 질문', '썜앤파커스','2014-11-30',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15611, '셀트리오니즘', '스마트북스','2016-01-23',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15612, '바이러스X', '이타북스','2018-07-02',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15613, '기분이 태도가 되지 않게', '갤리온','2015-09-30', 30433,'2', '2021-03-01', '2021-04-01');
INSERT INTO EBOOK VALUES (15614, '블랙 쇼맨과 이름없는 마을의 살인', '알에이치코리아','2013-05-16',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15615, '우먼 디자인', '민음사','2007-01-01',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15616, '적당히 가까운 사이', '허밍버드','2001-02-05',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15617, '어떻게 살면 좋겠냐고 묻는 딸에게', '다연','2017-10-19',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15618, '카이로스', '규장','2018-03-23', 30432, '0', '2021-03-05', '2021-03-16');
INSERT INTO EBOOK VALUES (15619, '추리소설가의 살인사건', '소미미디어','2011-07-17',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15620, '나 혼자 회의한다', 'BOOKLOVE','2002-04-30',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15621, '순서 파괴', '다산북스','2013-09-10',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15622, '요괴의 아이를 돌봐드립니다', '넥서스','2016-08-15',NULL,'0', NULL, NULL);
INSERT INTO EBOOK VALUES (15623, '힘들면 힘 내려놔', '지식인하우스','2012-10-10',30436,'2', '2011-03-04', '2021-04-04');
INSERT INTO EBOOK VALUES (15624, '12가지 인생의 법칙', '메이븐','2015-11-12',NULL,'0', NULL, NULL);

INSERT INTO AUTHORS VALUES (15600, '뉴욕주민');
INSERT INTO AUTHORS VALUES (15601, '미야자키 마사카츠');
INSERT INTO AUTHORS VALUES (15602, '이병덕');
INSERT INTO AUTHORS VALUES (15603, '이다 프렌티스 위트콤');
INSERT INTO AUTHORS VALUES (15604, '이하늬');
INSERT INTO AUTHORS VALUES (15605, '이윤기');
INSERT INTO AUTHORS VALUES (15606, '팀 켈러');
INSERT INTO AUTHORS VALUES (15607, '박계원');
INSERT INTO AUTHORS VALUES (15608, '아나이스 닌');
INSERT INTO AUTHORS VALUES (15609, '다나베 세이코');
INSERT INTO AUTHORS VALUES (15610, '권오현');
INSERT INTO AUTHORS VALUES (15611, '전예진');
INSERT INTO AUTHORS VALUES (15612, '김진명');
INSERT INTO AUTHORS VALUES (15613, '레몬심리');
INSERT INTO AUTHORS VALUES (15614, '히가시노 게이고');
INSERT INTO AUTHORS VALUES (15615, '리비 셀러스');
INSERT INTO AUTHORS VALUES (15616, '댄싱스네일');
INSERT INTO AUTHORS VALUES (15617, '한창욱');
INSERT INTO AUTHORS VALUES (15618, '고성준');
INSERT INTO AUTHORS VALUES (15619, '히가시노 게이코');
INSERT INTO AUTHORS VALUES (15620, '야마자키 타쿠미');
INSERT INTO AUTHORS VALUES (15621, '콜린 브라이어');
INSERT INTO AUTHORS VALUES (15622, '히로시마 레이코');
INSERT INTO AUTHORS VALUES (15623, '정다이');
INSERT INTO AUTHORS VALUES (15624, '조던 B. 피터슨');

INSERT INTO RESERVATION VALUES (15607, 30443, '2021-03-11');
INSERT INTO RESERVATION VALUES (15618, 30439, '2021-03-09');
INSERT INTO RESERVATION VALUES (15607, 30430, '2021-03-13');
INSERT INTO RESERVATION VALUES (15618, 30443, '2021-03-08');
INSERT INTO RESERVATION VALUES (15607, 30433, '2021-03-14');
INSERT INTO RESERVATION VALUES (15618, 30437, '2021-03-14');

INSERT INTO PREVIOUS_RENTAL VALUES (15616, '2021-01-04', '2021-01-15', 30435);
INSERT INTO PREVIOUS_RENTAL VALUES (15615, '2021-02-11', '2021-02-19', 30432);
INSERT INTO PREVIOUS_RENTAL VALUES (15602, '2021-02-17', '2021-03-10', 30441);
INSERT INTO PREVIOUS_RENTAL VALUES (15624, '2021-01-31', '2021-02-14', 30438);
INSERT INTO PREVIOUS_RENTAL VALUES (15606, '2021-01-23', '2021-02-06', 30439);
INSERT INTO PREVIOUS_RENTAL VALUES (15609, '2021-03-04', '2021-03-15', 30435);
INSERT INTO PREVIOUS_RENTAL VALUES (15607, '2021-02-03', '2021-02-24', 30443);
INSERT INTO PREVIOUS_RENTAL VALUES (15623, '2017-01-21', '2017-02-06',  30434 );
INSERT INTO PREVIOUS_RENTAL VALUES (15601, '2013-04-08', '2013-04-27',  30440 );
INSERT INTO PREVIOUS_RENTAL VALUES (15606, '2014-02-15', '2014-03-03',  30432 );
INSERT INTO PREVIOUS_RENTAL VALUES (15620, '2019-01-06', '2019-02-03',  30440 );
INSERT INTO PREVIOUS_RENTAL VALUES (15603, '2019-04-26', '2019-04-30',  30432 );
INSERT INTO PREVIOUS_RENTAL VALUES (15622, '2020-05-28', '2020-06-23',  30433 );
INSERT INTO PREVIOUS_RENTAL VALUES (15620, '2019-11-25', '2019-12-11',  30432 );
INSERT INTO PREVIOUS_RENTAL VALUES (15619, '2015-01-19', '2015-02-17',  30443 );
INSERT INTO PREVIOUS_RENTAL VALUES (15612, '2016-12-22', '2017-01-03',  30432 );
INSERT INTO PREVIOUS_RENTAL VALUES (15613, '2015-09-15', '2015-10-05',  30442 );

select * from EBOOK;




select * from all_tables where table_name = '테이블명';

select count(*) from all_tables where table_name = '테이블 명';

